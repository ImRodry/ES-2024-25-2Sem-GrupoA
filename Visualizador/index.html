<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8">
  <title>Visualizador de Propriedades</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
    }

    canvas {
      border: 1px solid #444;
      margin-top: 1rem;
    }
  </style>
</head>

<body>
  <h1>Visualizador de Propriedades</h1>
  <label for="select">Escolher propriedade:</label>
  <select id="select"></select>
  <canvas id="canvas" width="600" height="600"></canvas>

  <script>
    window.addEventListener('DOMContentLoaded', async () => {
      const propriedades = await fetch("propriedades.json")
        .then(res => res.json())

      const select = document.getElementById('select')
      const canvas = document.getElementById('canvas')
      const ctx = canvas.getContext('2d')

      propriedades.forEach(p => {
        const opt = document.createElement('option')
        opt.value = p.objectId
        opt.textContent = `ID ${p.objectId} - ${p.freguesia}`
        select.appendChild(opt)
      })

      select.addEventListener('change', () => {
        const prop = propriedades.find(p => p.objectId == select.value)
        if (prop) drawPolygon(prop.geometry)
      })

      drawPolygon(propriedades[0].geometry)

      function drawPolygon(coords) {
        ctx.clearRect(0, 0, canvas.width, canvas.height)

        const margin = 20
        const xs = coords.map(p => p[0])
        const ys = coords.map(p => p[1])
        const minX = Math.min(...xs)
        const minY = Math.min(...ys)
        const maxX = Math.max(...xs)
        const maxY = Math.max(...ys)
        const scaleX = (canvas.width - 2 * margin) / (maxX - minX)
        const scaleY = (canvas.height - 2 * margin) / (maxY - minY)
        const scale = Math.min(scaleX, scaleY)

        ctx.beginPath()
        coords.forEach(([x, y], i) => {
          const drawX = (x - minX) * scale + margin
          const drawY = canvas.height - ((y - minY) * scale + margin)
          i === 0 ? ctx.moveTo(drawX, drawY) : ctx.lineTo(drawX, drawY)
        })
        ctx.closePath()
        ctx.fillStyle = 'rgba(0, 123, 255, 0.3)'
        ctx.fill()
        ctx.strokeStyle = '#0078ff'
        ctx.lineWidth = 2
        ctx.stroke()
      }
    })
  </script>
</body>

</html>
